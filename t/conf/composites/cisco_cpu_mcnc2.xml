<?xml version="1.0" encoding="UTF-8" ?>

<composite>
    <variables>
        <input name="node" value="node_name" />
        <scan poll_value="cpu_value" oid_suffix="cpu_id" oid="1.3.6.1.4.1.9.9.109.1.1.1.1.7.*" />
        <scan poll_value="hardware_id" oid_suffix="hardware_oid" oid="1.3.6.1.4.1.9.9.109.1.1.1.1.2.*" />
        <scan poll_value="hardware_name" oid_suffix="dummy" oid="1.3.6.1.2.1.47.1.1.1.1.7.hardware_id"/>
    </variables>

    <data>
        <meta name="tmp" source="hardware_id"/>
        <meta name="hid" source="hardware_id"/>
        <meta name="node" source="node_name" />
        <meta name="name" source="hardware_name" />
        <value name="cpu" source="cpu_value" />
    </data>

    <conversions>

        <!-- Set the tmp var to alternate name only when hardware ID is 131 or 231 -->
        <function definition='"131" eq "cpu R0/0" "${}" ifelse'>
            <data name="tmp"/>
        </function>
        <function definition='"231" eq "cpu R0/1" "${}" ifelse'>
            <data name="tmp"/>
        </function>

        <!-- When tmp is still the hardware_id, set tmp to the parsed name -->
        <function definition='"${hid}" eq "${name}" "${}" ifelse'>
            <data name="tmp"/>
        </function>

        <!-- Replace the value for name with the result in tmp -->
        <replace this='${}' with='${tmp}'>
            <data name="name"/>
        </replace>

        <!-- Drop the temporary variables -->
        <drop>
            <data name="tmp"/>
            <data name="hid"/>
        </drop>
    </conversions>
</composite>
