<!DOCTYPE html>
<html>

    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>simp</title>
        <link rel="stylesheet" href="assets/bootstrap/css/bootstrap.min.css">
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=News+Cycle:400,700">
        <link rel="stylesheet" href="assets/css/user.css">

    </head>

    <body onload=loadPage()>
        <nav class="navbar navbar-default">
            <div class="container">
                <div class="navbar-header"><a class="navbar-brand" href="index.html">SIMP </a><button class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navcol-1"><span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button></div>
                <div class="collapse navbar-collapse" id="navcol-1">
                    <ul class="nav navbar-nav">
                        <li role="presentation"><a href="composite.html">composite </a></li>
                        <li role="presentation"><a href="data.html">data </a></li>
                        <li role="presentation"><a href="redis.html">redis </a></li>
                    </ul>
                </div>
            </div>
        </nav>
        <div class="container">
            <div class="row product">
                <div class="col-md-8 col-md-offset-0">
                    <form id = "comp_form" style="margin-top:30px;">
                        <div class="form-group">
                            <label class="control-label">
                                Composite
                            </label>
                            <select id = "comp_dropdown" class="form-control">
                                <option value="0" >Select the composite</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="control-label">
                                Host
                            </label>
                            <select id = "host_dropdown" class="form-control">
                                <option value="0">Please select a host</option>
                            </select>
                        </div>
                    </form>
                </div>
            </div>

            <div class="row">

                <div class="col-md-12">
                    <button type="button" class="btn btn-primary btn-sm" onclick="getData()">Submit</button>
                </div>
            </div>
            <div class="row">
                <div class="col-md-12">
                    <div class="page-header">
                        <h3>Results </h3>
                    </div>
                </div>
            </div>
            <div class="row product">
                <div id="result_elem" class="col-md-12 col-md-offset-0">
                </div>
            </div>

            <div class="panel-group" id="accordion">
            </div>
        </div>
        <footer class="site-footer">
            <div class="container">
                <hr>
                <div class="row">
                    <div class="col-sm-6">
                        <h5>SIMP Â© 2018</h5>
                    </div>
                    <div class="col-sm-6 social-icons"></div>
                </div>
            </div>
        </footer>
        <script src="assets/js/jquery.min.js"></script>
        <script src="assets/bootstrap/js/bootstrap.min.js"></script>
        <script type="text/javascript">
            var comp_url = '../cgi-dir/comp.cgi';
            var host_url = '../cgi-dir/populate_data.cgi';
            function loadPage() {
                var myRequest = new XMLHttpRequest();
                myRequest.onload = function(e) {

                    var jsonResponse = myRequest.response+'';
                    var split_response = jsonResponse.split(',');
                    var select = document.getElementById("comp_dropdown");
                    for (var i = 0; i < split_response.length; i++) {
                        var opt =  split_response[i];
                        var el = document.createElement("option");
                        el.textContent = opt;
                        el.value = opt;
                        if (opt == "mx960_light_lane0") {
                            el.selected = "selected";
                        }
                        select.appendChild(el);
                    }
                }
                webservice_call(myRequest, comp_url);
                
                var myRequest2 = new XMLHttpRequest();
                myRequest2.onload = function(e) {

                    console.log("Req 2:"); 
                    console.log(myRequest2.response);

                    var host_drop = document.getElementById("host_dropdown");

                    var hostObj= myRequest2.response.hosts;
                    var el = document.createElement("option");
                    for (var x in hostObj) {
                        // console.log(hostObj[x]);
                        var opt = hostObj[x];
                        var el = document.createElement("option");
                        el.textContent = opt;
                        el.value = opt;
                        if (opt == "199.8.216.92") {
                            el.selected = "selected";
                        }
                        host_drop.appendChild(el);
                         
                    }
                }
                webservice_call(myRequest2, host_url+'?method=get_initial_data&from=comp');
            }

            function webservice_call(request_object, url) {
                console.log(url);
                request_object.responseType = 'json';
                request_object.open('GET', url, true);
                request_object.send();
            }
            function getData() {
                var param_str = comp_url +"?";
                var composite = document.getElementById('comp_dropdown');
                var host = document.getElementById('host_dropdown');

                if (composite.selectedIndex == 0) {
                    alert ("Please select the composite");
                    return false;
                } else if (host.selectedIndex == 0){
                    alert ("Please select the host");
                    return false;
                } else {
                    param_str += "method=" + composite.options[composite.selectedIndex].text + "&host=" + host.options[host.selectedIndex].text;
                }
                console.log(param_str);
                var myRequest = new XMLHttpRequest();
                myRequest.responseType = 'json';
                myRequest.open('GET', param_str, true);
                myRequest.onload = function() {

                    var jsonObjStr= JSON.stringify(myRequest.response);
                    console.log(myRequest.response);
                    var result = myRequest.response.results;
                    var d = document;
                    var collapsible = d.getElementById("accordion");
                    collapsible.innerHTML = "";
                    for (var x in result) {

                        // console.log(x);
                        // console.log(myRequest.response.results[x]);
                        for (var y in result[x]) {
                            //  console.log(y);
                            //  console.log(result[x][y]);
                            var div1 = d.createElement('div');
                            div1.setAttribute("class", "panel panel-default");

                            var div2 = d.createElement('div');
                            div2.setAttribute("class", "panel-heading");

                            var title = d.createElement('h4');
                            title.setAttribute("class", "panel-title");

                            var aTag = d.createElement('a');
                            aTag.setAttribute("data-toggle", "collapse");
                            aTag.setAttribute("data-parent", "#accordion");
                            aTag.setAttribute("href", "#"+y);
                            aTag.innerHTML = y;

                            title.appendChild(aTag);
                            div2.appendChild(title);
                            div1.appendChild(div2);

                            var div3 = d.createElement('div');
                            div3.id = y;
                            div3.setAttribute("class", "panel-collapse collapse");

                            var div4 = d.createElement('div');
                            div4.setAttribute("class", "panel-body");
                            var temp_str = "";
                            for (var key in result[x][y]) {
                                // if (p.hasOwnProperty(key)) {
                                    // console.log(key + " -> " + result[x][y][key]);
                                    temp_str += key + " = " + result[x][y][key] + "<br>";

                                    //  }
                            }
                            // div4.innerHTML = JSON.stringify(result[x][y]);
                            div4.innerHTML = temp_str;

                            div3.appendChild(div4);
                            div1.appendChild(div3);

                            collapsible.appendChild(div1);
                        }
                    }
                }
                myRequest.send();
            }
        </script>
    </body>






</html>
